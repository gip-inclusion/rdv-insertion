<div class="container rdv-insertion-form text-dark-blue h4-as-labels mt-4">
  <div class="d-flex justify-content-between mb-4">
    <div>
      <%= link_to(return_path) do %>
        <button class="btn btn-blue-out" type="button">Annuler</button>
      <% end %>
    </div>
    <h1 class="h1-form-title d-none d-sm-inline"><%= title %></h1>
    <div>
      <button type="submit" class="btn btn-blue">Enregistrer</button>
    </div>
  </div>
  <div class="mb-4">
    <div class="row d-flex justify-content-start flex-wrap">
      <% unless category_configuration.persisted? %>
        <div class="d-flex flex-column align-items-center col-12 px-5 mb-4">
          <h4>Configuration pour : *</h4>
          <div class="position-relative w-100"
               style="max-width: 400px;"
               data-controller="dropdown-menu list-filter select-dropdown">

            <input type="text"
                   name="category_configuration[motif_category_id]"
                   id="motif_category_id"
                   data-select-dropdown-target="hiddenInput"
                   required="true"
                   class="visually-hidden">

            <button type="button"
                    class="form-select text-start d-flex justify-content-between align-items-center"
                    data-action="click->dropdown-menu#toggle"
                    data-dropdown-menu-target="button"
                    data-select-dropdown-target="button"
                    aria-haspopup="true"
                    aria-expanded="false">
              <span data-select-dropdown-target="label" style="pointer-events: none;"> Selectionner une catégorie </span>
            </button>

            <div class="dropdown-menu py-0 mt-2 w-100"
                 data-dropdown-menu-target="dropdown"
                 data-select-dropdown-target="dropdown"
                 style="max-height: 400px; overflow-y: auto;">
              <div class="px-3 pt-2 pb-2 border-bottom">
                <input type="text"
                        class="form-control form-control-sm"
                        placeholder="Rechercher une catégorie..."
                        data-list-filter-target="input"
                        data-action="input->list-filter#search"
                        autocomplete="off">
              </div>

              <% @authorized_motif_categories.each do |motif_category| %>
                <div class="dropdown-item py-2"
                     style="cursor: pointer;"
                     data-list-filter-target="item"
                     data-select-dropdown-target="option"
                     data-action="click->select-dropdown#select"
                     data-value="<%= motif_category.id %>"
                     data-label="<%= motif_category.name %>">
                  <%= motif_category.name %>
                </div>
              <% end %>

              <div class="dropdown-item py-2 text-muted text-center d-none"
                   data-list-filter-target="noResults">
                Aucun résultat
              </div>
            </div>
          </div>
        </div>
      <% end %>
      <%= render "common/attribute_input", f:f, attribute: :invitation_formats, as: :collection_check_boxes, collection: [["sms", "SMS"], ["email", "Email"], ["postal", "Courrier"]], mandatory: true %>
      <%= render "common/attribute_input", f:f, attribute: :convene_user, as: :boolean, mandatory: true %>
      <%= render "common/attribute_input", f:f, attribute: :rdv_with_referents, as: :boolean, mandatory: true %>
      <%= render "common/attribute_input", f:f, attribute: :invite_to_user_organisations_only, as: :boolean, mandatory: true %>
      <%= render "common/attribute_input", f:f, attribute: :phone_number, mandatory: false %>
    </div>

    <div class="row my-4">
      <%= render "category_configurations/invitations_expiration_form", f: f, category_configuration: category_configuration %>
    </div>
    <div class="row my-4">
      <%= render "category_configurations/external_email_notification_form", f: f, category_configuration: category_configuration %>
    </div>

    <% if category_configuration.persisted? %>
      <div class="row my-4">
        <h3>Contenu des messages</h3>
        <%= render "category_configurations/messages_contents/messages_content_form", f: f, template: template, category_configuration: category_configuration %>
      </div>
    <% end %>

    <div class="row my-4">
      <h3 class="px-5">Fichier d'import</h3>
      <div class="mb-4 px-5">
        <%= turbo_frame_tag "file_configurations_list" do %>
          <% @file_configurations.each do |file_configuration| %>
            <%= render "file_configurations/file_configuration_list_item", file_configuration: file_configuration, current_file_configuration: current_file_configuration, category_configuration:, organisation:, department: %>
          <% end %>
        <% end %>
      </div>
      <%= link_to new_file_configuration_path, class: "d-flex justify-content-center mb-4", data: { turbo_frame: 'remote_modal' } do %>
        <button class="btn btn-blue">Créer et utiliser un nouveau fichier d'import</button>
      <% end %>
    </div>
  </div>
</div>
