<% content_for :title, "Ajouter une catégorie - #{organisation.name} - rdv-insertion" %>

<div class="container mt-5 mb-5 pb-5 px-5">
  <%= form_with model: category_configuration,
                url: organisation_category_configurations_path(organisation),
                method: :post,
                data: {
                  controller: "accordion",
                  action: "dropdown--select-option:selected->accordion#enableAndOpenAll"
                } do |f| %>

    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="h4 text-dark-blue fw-bold">Ajouter une catégorie de motifs</h2>
        <p class="text-muted mb-0 w-90 small">
          Une catégorie permet de grouper les dossiers usagers dans une liste de suivi.
          Elle est reliée à un ou plusieurs motifs de rendez-vous.
        </p>
      </div>
      <%= link_to "https://rdv-insertion.gitbook.io/guide-dutilisation-rdv-insertion-and-faq/configuration/configuration-rdv-insertion-and-rdv-solidarites/configuration-rdv-insertion/categories-de-motifs", target: "_blank", class: "text-info border-bottom border-info" do %>
        <i class="ri-book-2-fill me-1"></i>Guide d'utilisation
      <% end %>
    </div>

    <div class="stepper w-75">
      <%# Step 1: Category selection %>
      <div class="stepper-step">
        <div class="stepper-step-header"
             data-action="click->accordion#toggle"
             data-index="0">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge active" data-accordion-target="badge">1</span>
            <span class="h5 fw-bold">Sélectionnez une catégorie</span>
          </div>
          <i class="ri-arrow-up-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content" data-accordion-target="content">
          <p class="text-muted mb-3 small">Choisissez parmi les catégories de motif disponibles sur rdv-insertion</p>
          <%= render "motif_category_select",
                     available_motif_categories: available_motif_categories %>
        </div>
      </div>

      <%# Step 2: RDV Preferences %>
      <div class="stepper-step">
        <div class="stepper-step-header disabled"
             data-action="click->accordion#toggle"
             data-index="1">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge inactive" data-accordion-target="badge">2</span>
            <span class="h5 fw-bold">Préférences de rendez-vous</span>
          </div>
          <i class="ri-arrow-down-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content d-none" data-accordion-target="content">
          <%= render "organisations/category_configurations/rdv_preferences/rdv_preference_fields", f: f, organisation: organisation %>
        </div>
      </div>

      <%# Step 3: Motifs (informational) %>
      <div class="stepper-step">
        <div class="stepper-step-header disabled"
             data-action="click->accordion#toggle"
             data-index="2">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge inactive" data-accordion-target="badge">3</span>
            <span class="h5 fw-bold">Motifs de rendez-vous</span>
          </div>
          <i class="ri-arrow-down-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content d-none" data-accordion-target="content">
          <p class="text-muted small mb-3">
            Pour permettre l'envoi des invitations et des convocations, vous devez créer des motifs de rendez-vous sur RDV-Solidarité et les rattacher à la catégorie RSA.
          </p>
          <%= link_to "#{ENV['RDV_SOLIDARITES_URL']}/admin/organisations/#{organisation.rdv_solidarites_organisation_id}/motifs", target: "_blank", class: "btn btn-blue-out" do %>
            <span>Créer les motifs de rendez-vous</span> <i class="ri-external-link-line ms-1"></i>
          <% end %>
        </div>
      </div>

      <%# Step 4: Messages %>
      <div class="stepper-step">
        <div class="stepper-step-header disabled"
             data-action="click->accordion#toggle"
             data-index="3">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge inactive" data-accordion-target="badge">4</span>
            <span class="h5 fw-bold">Paramètres d’invitation</span>
          </div>
          <i class="ri-arrow-down-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content d-none" data-accordion-target="content">
          <%= render "organisations/category_configurations/invitation_settings/invitation_setting_fields", f: f %>
        </div>
      </div>

      <%# Step 5: File import %>
      <div class="stepper-step">
        <div class="stepper-step-header disabled"
             data-action="click->accordion#toggle"
             data-index="4">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge inactive" data-accordion-target="badge">5</span>
            <span class="h5 fw-bold">Fichier d'import</span>
          </div>
          <i class="ri-arrow-down-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content d-none" data-accordion-target="content">
          <%= turbo_frame_tag "file_configuration_selection" do %>
            <div class="mb-4">
              <p class="text-muted small mb-3">
                Vous pouvez choisir le modèle de fichier d'import que vous souhaitez utiliser pour cette catégorie.
              </p>
              <%= link_to new_organisation_file_configuration_selection_path(organisation),
                          data: { turbo_frame: "remote_modal" },
                          class: "btn btn-blue-out" do %>
                Sélectionner un modèle de fichier
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <%# Step 6: Notifications %>
      <div class="stepper-step">
        <div class="stepper-step-header disabled"
             data-action="click->accordion#toggle"
             data-index="5">
          <div class="d-flex align-items-center">
            <span class="stepper-step-badge inactive" data-accordion-target="badge">6</span>
            <span class="h5 fw-bold">Notifications</span>
          </div>
          <i class="ri-arrow-down-s-line fs-4" data-accordion-target="icon"></i>
        </div>
        <div class="stepper-step-content d-none" data-accordion-target="content">
          <%= render "organisations/category_configurations/alertings/alerting_fields", f: f %>
        </div>
      </div>
    </div>

    <%# Sticky footer %>
    <div class="stepper-footer">
      <div class="container d-flex justify-content-between">
        <%= link_to organisation_configuration_categories_path(organisation),
                    class: "btn btn-blue-out",
                    data: { turbo_frame: "_top" } do %>
          Annuler
        <% end %>
        <%= f.submit "Ajouter la catégorie",
                     class: "btn btn-blue",
                     disabled: true,
                     data: { accordion_target: "submitButton" } %>
      </div>
    </div>
  <% end %>
</div>
