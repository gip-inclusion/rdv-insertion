<% is_selected = current_file_configuration&.id == file_configuration.id %>
<% relevant_category_configs = file_configuration.category_configurations
                                                 .select { |cc| cc.department_id == department.id && policy(cc).show? } %>

<div class="d-flex align-items-start gap-3 p-3 mb-3 rounded-3 background-blue-light">
  <div class="pt-1">
    <%= radio_button_tag :file_configuration_id,
                         file_configuration.id,
                         is_selected,
                         class: "form-check-input",
                         id: "file_configuration_#{file_configuration.id}" %>
  </div>

  <div class="flex-grow-1">
    <div class="d-flex align-items-center gap-2 mb-1">
      <label for="file_configuration_<%= file_configuration.id %>" class="fw-bold text-dark-blue mb-0 cursor-pointer">
        Fichier "<%= file_configuration.sheet_name %>"
      </label>
    </div>

    <div class="text-dark-blue small">
      <% if relevant_category_configs.any? %>
        <p class="mb-1">Utilisé pour :</p>
        <ul class="mb-0 ps-3">
          <% relevant_category_configs.group_by(&:motif_category).each do |motif_category, configs| %>
            <li>"<%= motif_category.name %>" par <%= configs.map(&:organisation).map(&:name).join(", ") %></li>
          <% end %>
        </ul>
      <% elsif file_configuration.created_by_agent?(current_agent) %>
        <p class="mb-0 text-muted">Créé par vous il y a <%= time_ago_in_words(file_configuration.created_at) %></p>
      <% else %>
        <p class="mb-0 text-muted">Non utilisé</p>
      <% end %>
    </div>
  </div>

  <div class="d-flex flex-column gap-2">
    <%= link_to file_configuration_path(file_configuration, return_to_path: request.path),
                data: { turbo_frame: "remote_modal" },
                class: "btn btn-blue-out btn-sm" do %>
      Voir le détail
    <% end %>
    <% if policy(file_configuration).edit? %>
      <%= link_to edit_file_configuration_path(file_configuration, return_to_path: request.path),
                  data: { turbo_frame: "remote_modal" },
                  class: "btn btn-blue-out btn-sm" do %>
        Modifier
      <% end %>
    <% else %>
      <div <%= tooltip(content: "Vous n'avez pas les droits pour modifier ce template de fichier car vous n'êtes pas administrateur de toutes les organisations qui l'utilisent") %>>
        <button class="btn btn-blue-out btn-sm w-100" disabled>Modifier</button>
      </div>
    <% end %>
  </div>
</div>
