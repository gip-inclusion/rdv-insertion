<%= turbo_frame_tag organisation do %>
  <%= form_with model: organisation, url: organisation_general_information_path(organisation), method: :patch do |f| %>
    <div class="card-white p-4 mb-4">
      <h3 class="h5 mb-2 fw-bold">Informations générales</h3>
      <p class="text-muted mb-4">
        Ces informations permettent d'identifier l'organisation, notamment dans les messages envoyés aux usagers.
      </p>

      <%= turbo_frame_tag "error_list" %>

      <div class="mb-4">
        <%= render "common/attribute_input_inline",
                   f: f,
                   attribute: :name,
                   label: "Nom de l'organisation",
                   mandatory: true %>

        <%= render "common/attribute_input_inline",
                   f: f,
                   attribute: :phone_number,
                   label: "Numéro de téléphone",
                   tooltip: {
                     icon: "ri-question-line",
                     content: "Le numéro de téléphone de l'organisation doit être renseigné pour inviter les usagers."
                   } %>

        <%= render "common/attribute_input_inline",
                   f: f,
                   attribute: :email,
                   label: "Adresse email",
                   tooltip: {
                     icon: "ri-question-line",
                     content: "Renseigner une adresse email vous permettra :<br>• de recevoir des alertes liées aux rendez-vous<br>• de fournir aux usagers un moyen de contacter l'organisation en cas de blocage lors de la prise de rendez-vous."
                   } %>

        <%= render "common/attribute_input_inline",
                   f: f,
                   attribute: :slug,
                   label: "Désignation de l'organisation<br>dans le fichier",
                   tooltip: {
                     icon: "ri-question-line",
                     content: "Permet de rattacher les usagers à l'organisation via le fichier d'import."
                   } %>
      </div>

      <div class="mb-4 mt-5" data-controller="image-upload">
        <h4 class="h6 fw-bold mb-1">Logo de l'organisation</h4>
        <p class="text-muted small mb-3">Logo au format .png ou .jpg. Taille de fichier maximale : 2 Mo</p>

        <%= f.hidden_field :remove_logo, value: "false", data: { image_upload_target: "removeField" } %>
        <%= f.file_field :logo,
                         class: "d-none",
                         id: "logo_input",
                         accept: "image/png, image/jpeg",
                         data: { image_upload_target: "input", action: "change->image-upload#handleFileSelect" } %>

        <div class="upload-zone rounded p-4 text-center col-8"
             data-image-upload-target="dropZone"
             data-action="dragover->image-upload#handleDragOver dragleave->image-upload#handleDragLeave drop->image-upload#handleDrop">

          <%# Preview (visible if logo exists or after file selection) %>
          <div data-image-upload-target="previewContainer" class="<%= organisation.logo.attached? ? '' : 'd-none' %>">
            <div class="mb-3">
              <% if organisation.logo.attached? %>
                <%= image_tag organisation.logo,
                              class: "img-fluid uploaded-image-preview",
                              alt: "Logo",
                              data: { image_upload_target: "previewImage" } %>
              <% else %>
                <img class="img-fluid uploaded-image-preview" alt="Logo" data-image-upload-target="previewImage">
              <% end %>
            </div>
            <p class="small mb-2">
              <span data-image-upload-target="fileName"><%= organisation.logo.filename if organisation.logo.attached? %></span>
              <a href="#" class="text-danger ms-1" data-action="click->image-upload#handleFileRemove">
                <i class="ri-close-line"></i>
              </a>
            </p>
            <label for="logo_input" class="btn btn-link p-0 text-decoration-none" tabindex="0" data-action="keydown->image-upload#handleOpenPickerKeydown">
              <i class="ri-folder-line me-1"></i><span class="text-decoration-underline">Changer de fichier</span>
            </label>
          </div>

          <%# Placeholder (visible when no logo) %>
          <div data-image-upload-target="placeholder" class="<%= organisation.logo.attached? ? 'd-none' : '' %>">
            <i class="ri-upload-cloud-2-line text-muted fs-2 d-block mb-2"></i>
            <p class="mb-1">Glisser/déposer le logo ici</p>
            <p class="text-muted mb-2">ou</p>
            <label for="logo_input" class="btn btn-link p-0 text-decoration-none" tabindex="0" data-action="keydown->image-upload#handleOpenPickerKeydown">
              <i class="ri-folder-line me-1"></i><span class="text-decoration-underline">Chercher dans vos fichiers</span>
            </label>
          </div>
        </div>
      </div>

      <p class="text-muted small mb-3">
        *Informations obligatoires pour garantir le bon fonctionnement de rdv-insertion.
      </p>

      <div class="d-flex justify-content-end">
        <%= link_to organisation_general_information_path(organisation), class: "btn btn-blue-out me-2" do %>
          Annuler
        <% end %>
        <%= f.submit "Enregistrer", class: "btn btn-primary" %>
      </div>
    </div>
  <% end %>
<% end %>

