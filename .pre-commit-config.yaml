# Pre-commit hooks configuration
#
# Installation:
#   pip install pre-commit && pre-commit install
#   # or with Homebrew:
#   brew install pre-commit && pre-commit install
#
# Gitleaks installation (required):
#   brew install gitleaks
#   # or see: https://github.com/gitleaks/gitleaks#installing
#
# Usage: pre-commit run --all-files (manual test)
# Auto-run: Before each git commit

repos:
  # Gitleaks - Secret detection in Git (requires gitleaks binary)
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.21.2
    hooks:
      - id: gitleaks
        name: Gitleaks - Scan secrets
        description: Detects secrets (API keys, tokens, passwords) before commit
        entry: gitleaks protect --verbose --redact --staged
        language: system
        pass_filenames: false
        stages: [pre-commit]

  # Optional: Standard Ruby/Rails hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # Basic checks
      - id: check-added-large-files
        name: Check large files
        args: ['--maxkb=500']

      - id: check-case-conflict
        name: Check case conflict

      - id: check-merge-conflict
        name: Check merge conflict

      - id: check-yaml
        name: Check YAML syntax
        exclude: \.github/workflows/.*\.yml$  # GitHub Actions has its own validation

      - id: end-of-file-fixer
        name: Fix end of file

      - id: trailing-whitespace
        name: Trim trailing whitespace
        args: [--markdown-linebreak-ext=md]

  # RuboCop - Ruby linter
  - repo: local
    hooks:
      - id: rubocop
        name: RuboCop
        entry: bundle exec rubocop --force-exclusion
        language: system
        types: [ruby]


  # ESLint - JavaScript linter
  - repo: local
    hooks:
      - id: eslint
        name: ESLint
        entry: yarn eslint
        args: [--quiet]
        language: system
        types: [javascript]

# Global configuration
default_language_version:
  python: python3

fail_fast: false  # Continue even if a hook fails (to see all problems)

# Files to exclude
exclude: |
  (?x)^(
    \.git/|
    \.github/|
    node_modules/|
    vendor/|
    tmp/|
    log/|
    public/packs/|
    public/assets/
  )$
